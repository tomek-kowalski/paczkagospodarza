"use strict";(self.webpackChunkMailPoet3=self.webpackChunkMailPoet3||[]).push([[392],{21918:function(e,t,n){var r={};n.r(r),n.d(r,{setIsMatching:function(){return T}});var a={};n.r(a),n.d(a,{isViewportMatch:function(){return L}});var i={};n.r(i),n.d(i,{set:function(){return $},setDefaults:function(){return B},setPersistenceLayer:function(){return U},toggle:function(){return V}});var s={};n.r(s),n.d(s,{get:function(){return z}});var o={};n.r(o),n.d(o,{disableComplementaryArea:function(){return Y},enableComplementaryArea:function(){return K},pinItem:function(){return q},setDefaultComplementaryArea:function(){return G},setFeatureDefaults:function(){return ee},setFeatureValue:function(){return X},toggleFeature:function(){return Q},unpinItem:function(){return J}});var l={};n.r(l),n.d(l,{getActiveComplementaryArea:function(){return ne},isFeatureActive:function(){return ae},isItemPinned:function(){return re}});var c={};n.r(c),n.d(c,{activate:function(){return Qe},closeSidebar:function(){return ze},openSidebar:function(){return Ue},registerStepType:function(){return Xe},save:function(){return Je},selectStep:function(){return Ye},setInserterPopoverAnchor:function(){return Ke},setWorkflowName:function(){return qe},toggleFeature:function(){return He},toggleInserterSidebar:function(){return Ge},updateStepArgs:function(){return et}});var d={};n.r(d),n.d(d,{getInserterActionSteps:function(){return it},getInserterLogicalSteps:function(){return st},getInserterPopoverAnchor:function(){return ot},getSelectedStep:function(){return dt},getSelectedStepType:function(){return pt},getStepType:function(){return ut},getWorkflowData:function(){return lt},getWorkflowSaved:function(){return ct},isFeatureActive:function(){return nt},isInserterSidebarOpened:function(){return at},isSidebarOpened:function(){return rt}});var u=n(65443),p=n.n(u),m=n(64151),f=n(33851),h=n(52278),g=n(3610),v=n(90057),_=n(87834),b=n(49231),x=n(33140),w=(0,b.createElement)(x.Wj,{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24"},(0,b.createElement)(x.y$,{d:"M20 10c0-5.51-4.49-10-10-10C4.48 0 0 4.49 0 10c0 5.52 4.48 10 10 10 5.51 0 10-4.48 10-10zM7.78 15.37L4.37 6.22c.55-.02 1.17-.08 1.17-.08.5-.06.44-1.13-.06-1.11 0 0-1.45.11-2.37.11-.18 0-.37 0-.58-.01C4.12 2.69 6.87 1.11 10 1.11c2.33 0 4.45.87 6.05 2.34-.68-.11-1.65.39-1.65 1.58 0 .74.45 1.36.9 2.1.35.61.55 1.36.55 2.46 0 1.49-1.4 5-1.4 5l-3.03-8.37c.54-.02.82-.17.82-.17.5-.05.44-1.25-.06-1.22 0 0-1.44.12-2.38.12-.87 0-2.33-.12-2.33-.12-.5-.03-.56 1.2-.06 1.22l.92.08 1.26 3.41zM17.41 10c.24-.64.74-1.87.43-4.25.7 1.29 1.05 2.71 1.05 4.25 0 3.29-1.73 6.24-4.4 7.78.97-2.59 1.94-5.2 2.92-7.78zM6.1 18.09C3.12 16.65 1.11 13.53 1.11 10c0-1.3.23-2.48.72-3.59C3.25 10.3 4.67 14.2 6.1 18.09zm4.03-6.63l2.58 6.98c-.86.29-1.76.45-2.71.45-.79 0-1.57-.11-2.29-.33.81-2.38 1.62-4.74 2.42-7.1z"})),y=n(86215),j=n(76874),S=n(85479),k=n(30337),E=n(62271),N=(0,b.createElement)(x.Wj,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,b.createElement)(x.y$,{d:"M11.776 4.454a.25.25 0 01.448 0l2.069 4.192a.25.25 0 00.188.137l4.626.672a.25.25 0 01.139.426l-3.348 3.263a.25.25 0 00-.072.222l.79 4.607a.25.25 0 01-.362.263l-4.138-2.175a.25.25 0 00-.232 0l-4.138 2.175a.25.25 0 01-.363-.263l.79-4.607a.25.25 0 00-.071-.222L4.754 9.881a.25.25 0 01.139-.426l4.626-.672a.25.25 0 00.188-.137l2.069-4.192z"})),C=(0,b.createElement)(x.Wj,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,b.createElement)(x.y$,{fillRule:"evenodd",d:"M9.706 8.646a.25.25 0 01-.188.137l-4.626.672a.25.25 0 00-.139.427l3.348 3.262a.25.25 0 01.072.222l-.79 4.607a.25.25 0 00.362.264l4.138-2.176a.25.25 0 01.233 0l4.137 2.175a.25.25 0 00.363-.263l-.79-4.607a.25.25 0 01.072-.222l3.347-3.262a.25.25 0 00-.139-.427l-4.626-.672a.25.25 0 01-.188-.137l-2.069-4.192a.25.25 0 00-.448 0L9.706 8.646zM12 7.39l-.948 1.921a1.75 1.75 0 01-1.317.957l-2.12.308 1.534 1.495c.412.402.6.982.503 1.55l-.362 2.11 1.896-.997a1.75 1.75 0 011.629 0l1.895.997-.362-2.11a1.75 1.75 0 01.504-1.55l1.533-1.495-2.12-.308a1.75 1.75 0 01-1.317-.957L12 7.39z",clipRule:"evenodd"})),A=n(61888),Z=n(38104),I=n(18024);function T(e){return{type:"SET_IS_MATCHING",values:e}}function L(e,t){return-1===t.indexOf(" ")&&(t=">= "+t),!!e[t]}const D=(0,I.Z)("core/viewport",{reducer:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return"SET_IS_MATCHING"===t.type?t.values:e},actions:r,selectors:a});(0,Z.register)(D);((e,t)=>{const n=(0,A.debounce)((()=>{const e=(0,A.mapValues)(r,(e=>e.matches));(0,Z.dispatch)(D).setIsMatching(e)}),{leading:!0}),r=(0,A.reduce)(e,((e,r,a)=>((0,A.forEach)(t,((t,i)=>{const s=window.matchMedia(`(${t}: ${r}px)`);s.addListener(n);const o=[i,a].join(" ");e[o]=s})),e)),{});window.addEventListener("orientationchange",n),n(),n.flush()})({huge:1440,wide:1280,large:960,medium:782,small:600,mobile:480},{"<":"max-width",">=":"min-width"});var P=n(62355),R=n(41356),M=n(79097),F=n.n(M);const O=function(e){let t;return(e,n)=>{if("SET_PERSISTENCE_LAYER"===n.type){const{persistenceLayer:e,persistedData:r}=n;return t=e,r}const r=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("SET_PREFERENCE_VALUE"===t.type){const{scope:n,name:r,value:a}=t;return{...e,[n]:{...e[n],[r]:a}}}return e}(e,n);var a;return"SET_PREFERENCE_VALUE"===n.type&&(null===(a=t)||void 0===a||a.set(r)),r}}();var W=F()({defaults:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("SET_PREFERENCE_DEFAULTS"===t.type){const{scope:n,defaults:r}=t;return{...e,[n]:{...e[n],...r}}}return e},preferences:O});function V(e,t){return function(n){let{select:r,dispatch:a}=n;const i=r.get(e,t);a.set(e,t,!i)}}function $(e,t,n){return{type:"SET_PREFERENCE_VALUE",scope:e,name:t,value:n}}function B(e,t){return{type:"SET_PREFERENCE_DEFAULTS",scope:e,defaults:t}}async function U(e){const t=await e.get();return{type:"SET_PERSISTENCE_LAYER",persistenceLayer:e,persistedData:t}}function z(e,t,n){var r,a;const i=null===(r=e.preferences[t])||void 0===r?void 0:r[n];return void 0!==i?i:null===(a=e.defaults[t])||void 0===a?void 0:a[n]}const H=(0,I.Z)("core/preferences",{reducer:W,actions:i,selectors:s});(0,Z.register)(H);const G=(e,t)=>({type:"SET_DEFAULT_COMPLEMENTARY_AREA",scope:e,area:t}),K=(e,t)=>n=>{let{registry:r,dispatch:a}=n;t&&(r.select(H).get(e,"isComplementaryAreaVisible")||r.dispatch(H).set(e,"isComplementaryAreaVisible",!0),a({type:"ENABLE_COMPLEMENTARY_AREA",scope:e,area:t}))},Y=e=>t=>{let{registry:n}=t;n.select(H).get(e,"isComplementaryAreaVisible")&&n.dispatch(H).set(e,"isComplementaryAreaVisible",!1)},q=(e,t)=>n=>{let{registry:r}=n;if(!t)return;const a=r.select(H).get(e,"pinnedItems");!0!==(null==a?void 0:a[t])&&r.dispatch(H).set(e,"pinnedItems",{...a,[t]:!0})},J=(e,t)=>n=>{let{registry:r}=n;if(!t)return;const a=r.select(H).get(e,"pinnedItems");r.dispatch(H).set(e,"pinnedItems",{...a,[t]:!1})};function Q(e,t){return function(n){let{registry:r}=n;(0,R.Z)("dispatch( 'core/interface' ).toggleFeature",{since:"6.0",alternative:"dispatch( 'core/preferences' ).toggle"}),r.dispatch(H).toggle(e,t)}}function X(e,t,n){return function(r){let{registry:a}=r;(0,R.Z)("dispatch( 'core/interface' ).setFeatureValue",{since:"6.0",alternative:"dispatch( 'core/preferences' ).set"}),a.dispatch(H).set(e,t,!!n)}}function ee(e,t){return function(n){let{registry:r}=n;(0,R.Z)("dispatch( 'core/interface' ).setFeatureDefaults",{since:"6.0",alternative:"dispatch( 'core/preferences' ).setDefaults"}),r.dispatch(H).setDefaults(e,t)}}var te=n(96982);const ne=(0,te.M)((e=>(t,n)=>{var r;const a=e(H).get(n,"isComplementaryAreaVisible");if(void 0!==a)return a?null==t||null===(r=t.complementaryAreas)||void 0===r?void 0:r[n]:null})),re=(0,te.M)((e=>(t,n,r)=>{var a;const i=e(H).get(n,"pinnedItems");return null===(a=null==i?void 0:i[r])||void 0===a||a})),ae=(0,te.M)((e=>(t,n,r)=>((0,R.Z)("select( 'core/interface' ).isFeatureActive( scope, featureName )",{since:"6.0",alternative:"select( 'core/preferences' ).get( scope, featureName )"}),!!e(H).get(n,r))));var ie=F()({complementaryAreas:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DEFAULT_COMPLEMENTARY_AREA":{const{scope:n,area:r}=t;return e[n]?e:{...e,[n]:r}}case"ENABLE_COMPLEMENTARY_AREA":{const{scope:n,area:r}=t;return{...e,[n]:r}}}return e}});const se=(0,I.Z)("core/interface",{reducer:ie,actions:o,selectors:l});(0,Z.register)(se),n(35721),n(4857);var oe=n(73703);const{Consumer:le,Provider:ce}=(0,b.createContext)({name:null,icon:null});var de,ue=(de=(e,t)=>({icon:t.icon||e.icon,identifier:t.identifier||`${e.name}/${t.name}`}),(0,oe.o)((e=>t=>(0,b.createElement)(le,null,(n=>(0,b.createElement)(e,(0,y.Z)({},t,de(n,t)))))),"withPluginContext")),pe=ue((function(e){let{as:t=h.Z,scope:n,identifier:r,icon:a,selectedIcon:i,name:s,...o}=e;const l=t,c=(0,_.Z)((e=>e(se).getActiveComplementaryArea(n)===r),[r]),{enableComplementaryArea:d,disableComplementaryArea:u}=(0,S.Z)(se);return(0,b.createElement)(l,(0,y.Z)({icon:i&&c?i:a,onClick:()=>{c?u(n):d(n,r)}},o))})),me=e=>{let{smallScreenTitle:t,children:n,className:r,toggleButtonProps:a}=e;const i=(0,b.createElement)(pe,(0,y.Z)({icon:P.Z},a));return(0,b.createElement)(b.Fragment,null,(0,b.createElement)("div",{className:"components-panel__header interface-complementary-area-header__small"},t&&(0,b.createElement)("span",{className:"interface-complementary-area-header__small-title"},t),i),(0,b.createElement)("div",{className:p()("components-panel__header","interface-complementary-area-header",r),tabIndex:-1},n,i))},fe=n(73435),he=n(82741);const ge=()=>{};function ve(e){let{name:t,as:n=h.Z,onClick:r,...a}=e;return(0,b.createElement)(f.de,{name:t},(e=>{let{onClick:t}=e;return(0,b.createElement)(n,(0,y.Z)({onClick:r||t?function(){(r||ge)(...arguments),(t||ge)(...arguments)}:void 0},a))}))}ve.Slot=function(e){let{name:t,as:n=he.Z,fillProps:r={},bubblesVirtually:a,...i}=e;return(0,b.createElement)(f.g7,{name:t,bubblesVirtually:a,fillProps:r},(e=>{if(!b.Children.toArray(e).length)return null;const t=[];b.Children.forEach(e,(e=>{let{props:{__unstableExplicitMenuItem:n,__unstableTarget:r}}=e;r&&n&&t.push(r)}));const r=b.Children.map(e,(e=>!e.props.__unstableExplicitMenuItem&&t.includes(e.props.__unstableTarget)?null:e));return(0,b.createElement)(n,i,r)}))};var _e=ve;const be=e=>{let{__unstableExplicitMenuItem:t,__unstableTarget:n,...r}=e;return(0,b.createElement)(fe.Z,r)};function xe(e){let{scope:t,target:n,__unstableExplicitMenuItem:r,...a}=e;return(0,b.createElement)(pe,(0,y.Z)({as:e=>(0,b.createElement)(_e,(0,y.Z)({__unstableExplicitMenuItem:r,__unstableTarget:`${t}/${n}`,as:be,name:`${t}/plugin-more-menu`},e)),role:"menuitemcheckbox",selectedIcon:E.Z,name:n,scope:t},a))}function we(e){let{scope:t,...n}=e;return(0,b.createElement)(f.de,(0,y.Z)({name:`PinnedItems/${t}`},n))}we.Slot=function(e){let{scope:t,className:n,...r}=e;return(0,b.createElement)(f.g7,(0,y.Z)({name:`PinnedItems/${t}`},r),(e=>(null==e?void 0:e.length)>0&&(0,b.createElement)("div",{className:p()(n,"interface-pinned-items")},e)))};var ye=we;function je(e){let{scope:t,children:n,className:r}=e;return(0,b.createElement)(f.de,{name:`ComplementaryArea/${t}`},(0,b.createElement)("div",{className:r},n))}const Se=ue((function(e){let{children:t,className:n,closeLabel:r=(0,k.__)("Close plugin"),identifier:a,header:i,headerClassName:s,icon:o,isPinnable:l=!0,panelClassName:c,scope:d,name:u,smallScreenTitle:m,title:f,toggleShortcut:g,isActiveByDefault:v,showIconLabels:x=!1}=e;const{isActive:w,isPinned:y,activeArea:A,isSmall:Z,isLarge:I}=(0,_.Z)((e=>{const{getActiveComplementaryArea:t,isItemPinned:n}=e(se),r=t(d);return{isActive:r===a,isPinned:n(d,a),activeArea:r,isSmall:e(D).isViewportMatch("< medium"),isLarge:e(D).isViewportMatch("large")}}),[a,d]);!function(e,t,n,r,a){const i=(0,b.useRef)(!1),s=(0,b.useRef)(!1),{enableComplementaryArea:o,disableComplementaryArea:l}=(0,S.Z)(se);(0,b.useEffect)((()=>{r&&a&&!i.current?(l(e),s.current=!0):s.current&&!a&&i.current?(s.current=!1,o(e,t)):s.current&&n&&n!==t&&(s.current=!1),a!==i.current&&(i.current=a)}),[r,a,e,t,n])}(d,a,A,w,Z);const{enableComplementaryArea:T,disableComplementaryArea:L,pinItem:P,unpinItem:R}=(0,S.Z)(se);return(0,b.useEffect)((()=>{v&&void 0===A&&!Z&&T(d,a)}),[A,v,d,a,Z]),(0,b.createElement)(b.Fragment,null,l&&(0,b.createElement)(ye,{scope:d},y&&(0,b.createElement)(pe,{scope:d,identifier:a,isPressed:w&&(!x||I),"aria-expanded":w,label:f,icon:x?E.Z:o,showTooltip:!x,variant:x?"tertiary":void 0})),u&&l&&(0,b.createElement)(xe,{target:u,scope:d,icon:o},f),w&&(0,b.createElement)(je,{className:p()("interface-complementary-area",n),scope:d},(0,b.createElement)(me,{className:s,closeLabel:r,onClose:()=>L(d),smallScreenTitle:m,toggleButtonProps:{label:r,shortcut:g,scope:d,identifier:a}},i||(0,b.createElement)(b.Fragment,null,(0,b.createElement)("strong",null,f),l&&(0,b.createElement)(h.Z,{className:"interface-complementary-area__pin-unpin-item",icon:y?N:C,label:y?(0,k.__)("Unpin from toolbar"):(0,k.__)("Pin to toolbar"),onClick:()=>(y?R:P)(d,a),isPressed:y,"aria-expanded":y}))),(0,b.createElement)(j.Z,{className:c},t)))}));Se.Slot=function(e){let{scope:t,...n}=e;return(0,b.createElement)(f.g7,(0,y.Z)({name:`ComplementaryArea/${t}`},n))};var ke=Se,Ee=e=>{let{isActive:t}=e;return(0,b.useEffect)((()=>{let e=!1;return document.body.classList.contains("sticky-menu")&&(e=!0,document.body.classList.remove("sticky-menu")),()=>{e&&document.body.classList.add("sticky-menu")}}),[]),(0,b.useEffect)((()=>(t?document.body.classList.add("is-fullscreen-mode"):document.body.classList.remove("is-fullscreen-mode"),()=>{t&&document.body.classList.remove("is-fullscreen-mode")})),[t]),null},Ne=n(28678),Ce=n(10356),Ae=(0,b.forwardRef)((function(e,t){let{footer:n,header:r,sidebar:a,secondarySidebar:i,notices:s,content:o,drawer:l,actions:c,labels:d,className:u,shortcuts:m}=e;const f=(0,Ne.U)(m);!function(e){(0,b.useEffect)((()=>{const t=document&&document.querySelector(`html:not(.${e})`);if(t)return t.classList.toggle(e),()=>{t.classList.toggle(e)}}),[e])}("interface-interface-skeleton__html-container");const h={drawer:(0,k.__)("Drawer"),header:(0,k.__)("Header"),body:(0,k.__)("Content"),secondarySidebar:(0,k.__)("Block Library"),sidebar:(0,k.__)("Settings"),actions:(0,k.__)("Publish"),footer:(0,k.__)("Footer"),...d};return(0,b.createElement)("div",(0,y.Z)({},f,{ref:(0,Ce.Z)([t,f.ref]),className:p()(u,"interface-interface-skeleton",f.className,!!n&&"has-footer")}),!!l&&(0,b.createElement)("div",{className:"interface-interface-skeleton__drawer",role:"region","aria-label":h.drawer,tabIndex:"-1"},l),(0,b.createElement)("div",{className:"interface-interface-skeleton__editor"},!!r&&(0,b.createElement)("div",{className:"interface-interface-skeleton__header",role:"region","aria-label":h.header,tabIndex:"-1"},r),(0,b.createElement)("div",{className:"interface-interface-skeleton__body"},!!i&&(0,b.createElement)("div",{className:"interface-interface-skeleton__secondary-sidebar",role:"region","aria-label":h.secondarySidebar,tabIndex:"-1"},i),!!s&&(0,b.createElement)("div",{className:"interface-interface-skeleton__notices"},s),(0,b.createElement)("div",{className:"interface-interface-skeleton__content",role:"region","aria-label":h.body,tabIndex:"-1"},o),!!a&&(0,b.createElement)("div",{className:"interface-interface-skeleton__sidebar",role:"region","aria-label":h.sidebar,tabIndex:"-1"},a),!!c&&(0,b.createElement)("div",{className:"interface-interface-skeleton__actions",role:"region","aria-label":h.actions,tabIndex:"-1"},c))),!!n&&(0,b.createElement)("div",{className:"interface-interface-skeleton__footer",role:"region","aria-label":h.footer,tabIndex:"-1"},n))})),Ze=n(83115),Ie=n(62006);function Te(e){let{as:t=Ze.Z,className:n,label:r=(0,k.__)("Options"),popoverProps:a,toggleProps:i,children:s}=e;return(0,b.createElement)(t,{className:p()("interface-more-menu-dropdown",n),icon:Ie.Z,label:r,popoverProps:{position:"bottom left",...a,className:p()("interface-more-menu-dropdown__content",null==a?void 0:a.className)},toggleProps:{tooltipPosition:"bottom",...i}},(e=>s(e)))}var Le=n(353),De=n(67911),Pe=n(54600),Re=n(17921),Me=n(14676),Fe=n(34380),Oe=n(82435);const We="mailpoet/automation-editor",Ve="mailpoet/automation-editor/workflow",$e="mailpoet/automation-editor/step";var Be=n(36073);const Ue=e=>t=>{let{registry:n}=t;return n.dispatch(se).enableComplementaryArea(We,e)},ze=()=>e=>{let{registry:t}=e;return t.dispatch(se).disableComplementaryArea(We)},He=e=>t=>{let{registry:n}=t;return n.dispatch(H).toggle(We,e)};function Ge(){return{type:"TOGGLE_INSERTER_SIDEBAR"}}function Ke(e){return{type:"SET_INSERTER_POPOVER_ANCHOR",anchor:e}}function Ye(e){return{type:"SET_SELECTED_STEP",value:e}}function qe(e){const t=(0,Z.select)(We).getWorkflowData();return t.name=e,{type:"UPDATE_WORKFLOW",workflow:t}}function*Je(){const e=(0,Z.select)(We).getWorkflowData();return{type:"SAVE",workflow:(yield(0,Be.SC)({path:`/workflows/${e.id}`,method:"PUT",data:e})).data}}function*Qe(){const e=(0,Z.select)(We).getWorkflowData();return{type:"ACTIVATE",workflow:(yield(0,Be.SC)({path:`/workflows/${e.id}`,method:"PUT",data:{...e,status:"active"}})).data}}function Xe(e){return{type:"REGISTER_STEP_TYPE",stepType:e}}function et(e,t,n){return{type:"UPDATE_STEP_ARGS",stepId:e,name:t,value:n}}const tt={stepTypes:{},workflowData:{...window.mailpoet_automation_workflow},workflowSaved:!0,selectedStep:void 0,inserterSidebar:{isOpened:!1},inserterPopover:{anchor:void 0}},nt=(0,te.M)((e=>(t,n)=>e(H).get(We,n))),rt=(0,te.M)((e=>()=>!!e(se).getActiveComplementaryArea(We)));function at(e){return e.inserterSidebar.isOpened}function it(e){return Object.values(e.stepTypes).filter((e=>{let{group:t}=e;return"actions"===t}))}function st(e){return Object.values(e.stepTypes).filter((e=>{let{group:t}=e;return"logical"===t}))}function ot(e){return e.inserterPopover.anchor}function lt(e){return e.workflowData}function ct(e){return e.workflowSaved}function dt(e){return e.selectedStep}function ut(e,t){return e.stepTypes[t]??void 0}function pt(e){var t;return ut(e,null===(t=e.selectedStep)||void 0===t?void 0:t.key)}const mt=(0,I.Z)(We,{actions:c,controls:Be.ai,selectors:d,reducer:function(e,t){switch(t.type){case"TOGGLE_INSERTER_SIDEBAR":return{...e,inserterSidebar:{...e.inserterSidebar,isOpened:!e.inserterSidebar.isOpened}};case"SET_INSERTER_POPOVER_ANCHOR":return{...e,inserterPopover:{...e.inserterPopover,anchor:t.anchor}};case"SET_SELECTED_STEP":return{...e,selectedStep:t.value};case"UPDATE_WORKFLOW":return{...e,workflowData:t.workflow,workflowSaved:!1};case"SAVE":case"ACTIVATE":return{...e,workflowData:t.workflow,workflowSaved:!0};case"REGISTER_STEP_TYPE":return{...e,stepTypes:{...e.stepTypes,[t.stepType.key]:t.stepType}};case"UPDATE_STEP_ARGS":{const n=e.workflowData.steps[t.stepId].args??{},r="function"==typeof t.value?t.value(n[t.name]??void 0):t.value,a={...n,[t.name]:r},i={...e.workflowData.steps[t.stepId],args:a};return{...e,workflowData:{...e.workflowData,steps:{...e.workflowData.steps,[t.stepId]:i}},workflowSaved:!1,selectedStep:i}}default:return e}},initialState:tt});(0,Z.register)(mt);const ft=e=>{(0,Z.dispatch)(mt).registerStepType(e)};var ht=n(41325),gt=n(20264);const vt=Re.Z;function _t(e){let{children:t}=e;const{workflowName:n,workflowStatus:r,showIconLabels:a}=(0,_.Z)((e=>({workflowName:e(mt).getWorkflowData().name,workflowStatus:e(mt).getWorkflowData().status,showIconLabels:e(mt).isFeatureActive("showIconLabels")})),[]),i=(0,b.useRef)();let s="mailpoet-automation-editor-chip-gray";return r===ht.x.ACTIVE?s="mailpoet-automation-editor-chip-success":r===ht.x.INACTIVE&&(s="mailpoet-automation-editor-chip-danger"),(0,gt.jsx)("div",{className:"edit-site-document-actions has-secondary-label",children:(0,gt.jsx)("div",{ref:i,className:"edit-site-document-actions__title-wrapper",children:t&&(0,gt.jsx)(vt,{popoverProps:{anchorRef:i.current},position:"bottom center",renderToggle:e=>{let{isOpen:t,onToggle:i}=e;return(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsxs)("a",{className:"mailpoet-automation-editor-dropdown-toggle-link",href:"#",onClick:i,children:[(0,gt.jsxs)(Me.Z,{size:"body",className:"edit-site-document-actions__title",as:"h1",children:[(0,gt.jsx)(Fe.Z,{as:"span",children:(0,k.__)("Editing workflow: ")}),n]}),(0,gt.jsxs)(Me.Z,{size:"body",className:`edit-site-document-actions__secondary-item ${s}`,children:[r===ht.x.ACTIVE&&(0,k.__)("Active"),r===ht.x.INACTIVE&&(0,k.__)("Inactive"),r===ht.x.DRAFT&&(0,k.__)("Draft")]})]}),(0,gt.jsx)(h.Z,{className:"edit-site-document-actions__get-info",icon:Oe.Z,"aria-expanded":t,"aria-haspopup":"true",onClick:i,label:(0,k.__)("Change workflow name"),children:a&&(0,k.__)("Rename")})]})},contentClassName:"edit-site-document-actions__info-dropdown",renderContent:t})})})}var bt=n(9487),xt=n(96097);function wt(){const{isInserterOpened:e,showIconLabels:t}=(0,_.Z)((e=>({isInserterOpened:e(mt).isInserterSidebarOpened(),showIconLabels:e(mt).isFeatureActive("showIconLabels")})),[]),{toggleInserterSidebar:n}=(0,S.Z)(mt);return(0,gt.jsx)(bt.Z,{as:h.Z,className:"edit-site-header-toolbar__inserter-toggle",variant:"primary",isPressed:e,onMouseDown:e=>e.preventDefault(),onClick:n,icon:xt.Z,label:(0,k._x)("Toggle step inserter","Generic label for step inserter button"),showTooltip:!t,children:t&&(e?(0,k.__)("Close"):(0,k.__)("Add"))})}var yt=n(53703),jt=n(83830),St=n(45538);function kt(e){let{scope:t,name:n,label:r,info:a,messageActivated:i,messageDeactivated:s,shortcut:o}=e;const l=(0,_.Z)((e=>!!e(H).get(t,n)),[n]),{toggle:c}=(0,S.Z)(H);return(0,b.createElement)(fe.Z,{icon:l&&E.Z,isSelected:l,onClick:()=>{c(t,n),(()=>{if(l){const e=s||(0,k.sprintf)((0,k.__)("Preference deactivated - %s"),r);(0,St.D)(e)}else{const e=i||(0,k.sprintf)((0,k.__)("Preference activated - %s"),r);(0,St.D)(e)}})()},role:"menuitemcheckbox",info:a,shortcut:o},r)}function Et(){return(0,gt.jsx)(Te,{className:"edit-site-more-menu",popoverProps:{className:"edit-site-more-menu__content"},children:()=>(0,gt.jsx)(yt.Z,{label:(0,k._x)("View","noun"),children:(0,gt.jsx)(kt,{scope:We,name:"fullscreenMode",label:(0,k.__)("Fullscreen mode"),info:(0,k.__)("Work without distraction"),messageActivated:(0,k.__)("Fullscreen mode activated"),messageDeactivated:(0,k.__)("Fullscreen mode deactivated"),shortcut:jt.displayShortcut.secondary("f")})})})}function Nt(){const{activate:e}=(0,S.Z)(mt);return(0,gt.jsx)(h.Z,{isPrimary:!0,className:"editor-post-publish-button",onClick:e,children:"Activate"})}function Ct(){const{activate:e}=(0,S.Z)(mt);return(0,gt.jsx)(h.Z,{isPrimary:!0,className:"editor-post-publish-button",onClick:e,children:"Update"})}function At(){const{save:e}=(0,S.Z)(mt);return(0,gt.jsx)(h.Z,{isTertiary:!0,onClick:e,children:(0,k.__)("Save Draft")})}function Zt(){const{setWorkflowName:e}=(0,S.Z)(mt),{workflowName:t,workflowStatus:n}=(0,_.Z)((e=>({workflowName:e(mt).getWorkflowData().name,workflowStatus:e(mt).getWorkflowData().status})),[]);return(0,gt.jsxs)("div",{className:"edit-site-header",children:[(0,gt.jsx)("div",{className:"edit-site-header_start",children:(0,gt.jsx)(De.Z,{className:"edit-site-header__toolbar",orientation:"horizontal",role:"toolbar",children:(0,gt.jsx)(wt,{})})}),(0,gt.jsx)("div",{className:"edit-site-header_center",children:(0,gt.jsx)(_t,{children:()=>(0,gt.jsxs)("div",{className:"mailpoet-automation-editor-dropdown-name-edit",children:[(0,gt.jsx)("div",{className:"mailpoet-automation-editor-dropdown-name-edit-title",children:(0,k.__)("Automation name")}),(0,gt.jsx)(Pe.Z,{value:t,onChange:t=>e(t),help:(0,k.__)('Give the automation a name that indicates its purpose. E.g. "Abandoned cart recovery"')})]})})}),(0,gt.jsx)("div",{className:"edit-site-header_end",children:(0,gt.jsxs)("div",{className:"edit-site-header__actions",children:[(0,gt.jsx)(At,{}),n!==ht.x.ACTIVE&&(0,gt.jsx)(Nt,{}),n===ht.x.ACTIVE&&(0,gt.jsx)(Ct,{}),(0,gt.jsx)(ye.Slot,{scope:We}),(0,gt.jsx)(Et,{})]})})]})}var It=n(2637),Tt=n(47842),Lt=n(1779);function Dt(e){let{icon:t}=e;return(0,gt.jsx)("span",{className:"block-editor-block-icon",children:(0,gt.jsx)(g.Z,{icon:t})})}function Pt(e){let{item:t}=e;const{title:n,icon:r,description:a}=t;return(0,gt.jsx)("div",{className:"block-editor-inserter__preview-container",children:(0,gt.jsxs)("div",{className:"block-editor-block-card",children:[(0,gt.jsx)(Dt,{icon:r}),(0,gt.jsxs)("div",{className:"block-editor-block-card__content",children:[(0,gt.jsx)("h2",{className:"block-editor-block-card__title",children:n}),(0,gt.jsx)("span",{className:"block-editor-block-card__description",children:a})]})]})})}var Rt=n(88565);const Mt=(0,b.createContext)(void 0),Ft=(0,b.forwardRef)(((e,t)=>{let{isFirst:n,children:r,...a}=e;const i=(0,b.useContext)(Mt);return(0,gt.jsx)(Rt.A,{ref:t,state:i,role:"option",focusable:!0,...a,children:e=>{const t={...e,tabIndex:n?0:e.tabIndex};return(0,gt.jsx)(h.Z,{...t,children:r})}})})),Ot=()=>{const{platform:e}=window.navigator;return-1!==e.indexOf("Mac")||["iPad","iPhone"].includes(e)},Wt=(0,b.memo)((e=>{let{className:t,isFirst:n,item:r,onSelect:a,onHover:i,isDraggable:s,...o}=e;const l=(0,b.useRef)(!1);return(0,gt.jsx)("div",{className:"block-editor-block-types-list__list-item",children:(0,gt.jsxs)(Ft,{isFirst:n,className:p()("block-editor-block-types-list__item",t),disabled:r.isDisabled,onClick:e=>{e.preventDefault(),a(r,Ot()?e.metaKey:e.ctrlKey),i(null)},onKeyDown:e=>{const{keyCode:t}=e;t===jt.ENTER&&(e.preventDefault(),a(r,Ot()?e.metaKey:e.ctrlKey),i(null))},onFocus:()=>{l.current||i(r)},onMouseEnter:()=>{l.current||i(r)},onMouseLeave:()=>i(null),onBlur:()=>i(null),...o,children:[(0,gt.jsx)("span",{className:"block-editor-block-types-list__item-icon",children:(0,gt.jsx)(Dt,{icon:r.icon})}),(0,gt.jsx)("span",{className:"block-editor-block-types-list__item-title",children:r.title})]})})})),Vt=(0,b.forwardRef)(((e,t)=>{const[n,r]=(0,b.useState)(!1);return(0,b.useEffect)((()=>{n&&(0,St.D)((0,k.__)("Use left and right arrow keys to move through blocks"))}),[n]),(0,gt.jsx)("div",{ref:t,role:"listbox","aria-orientation":"horizontal",onFocus:()=>{r(!0)},onBlur:e=>{!e.currentTarget.contains(e.relatedTarget)&&r(!1)},...e})}));var $t=n(17750);const Bt=(0,b.forwardRef)(((e,t)=>{const n=(0,b.useContext)(Mt);return(0,gt.jsx)($t.E,{state:n,role:"presentation",ref:t,...e})})),Ut=(e,t)=>{const n=[];for(let r=0,a=e.length;r<a;r+=t)n.push(e.slice(r,r+t));return n};function zt(e){let{items:t,onSelect:n,onHover:r,label:a,isDraggable:i=!0,children:s}=e;return(0,gt.jsxs)(Vt,{className:"block-editor-block-types-list","aria-label":a,children:[Ut(t,3).map(((e,t)=>(0,gt.jsx)(Bt,{children:e.map(((e,a)=>{return(0,gt.jsx)(Wt,{item:e,className:(s=e.key,`editor-block-list-item-${s.replace(/\//,"-")}`),onSelect:n,onHover:r,isDraggable:i,isFirst:0===t&&0===a},e.key);var s}))},t))),s]})}var Ht=n(15596);function Gt(e){let{children:t}=e;const n=(0,Ht.u)({shift:!0,wrap:"horizontal"});return(0,gt.jsx)(Mt.Provider,{value:n,children:t})}const Kt=(e,t)=>t.filter((t=>t.title.toLowerCase().includes(e.trim().toLowerCase()))),Yt=(0,b.forwardRef)(((e,t)=>{const[n,r]=(0,b.useState)(""),[a,i]=(0,b.useState)(null),{actionSteps:s,logicalSteps:o}=(0,_.Z)((e=>({actionSteps:e(mt).getInserterActionSteps(),logicalSteps:e(mt).getInserterLogicalSteps()})),[]),l=(0,b.useCallback)((e=>{i(e)}),[i]),c=(0,b.useRef)();(0,b.useImperativeHandle)(t,(()=>({focusSearch:()=>{var e;null===(e=c.current)||void 0===e||e.focus()}})));const d=(0,b.useMemo)((()=>Kt(n,s)),[s,n]),u=(0,b.useMemo)((()=>Kt(n,o)),[n,o]);return(0,gt.jsxs)("div",{className:"block-editor-inserter__menu",children:[(0,gt.jsx)("div",{className:"block-editor-inserter__main-area",children:(0,gt.jsxs)("div",{className:"block-editor-inserter__content",children:[(0,gt.jsx)(It.Z,{className:"block-editor-inserter__search",onChange:e=>{a&&i(null),r(e)},value:n,label:(0,k.__)("Search for blocks and patterns"),placeholder:(0,k.__)("Search"),ref:c}),(0,gt.jsx)("div",{className:"block-editor-inserter__block-list",children:(0,gt.jsxs)(Gt,{children:[d.length>0&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("div",{className:"block-editor-inserter__panel-header",children:(0,gt.jsx)("h2",{className:"block-editor-inserter__panel-title",children:(0,gt.jsx)("div",{children:"Actions"})})}),(0,gt.jsx)("div",{className:"block-editor-inserter__panel-content",children:(0,gt.jsx)(zt,{items:d,onHover:l,onSelect:()=>{},label:"A"})})]}),u.length>0&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("div",{className:"block-editor-inserter__panel-header",children:(0,gt.jsx)("h2",{className:"block-editor-inserter__panel-title",children:(0,gt.jsx)("div",{children:"Logical"})})}),(0,gt.jsx)("div",{className:"block-editor-inserter__panel-content",children:(0,gt.jsx)(zt,{items:u,onHover:l,onSelect:()=>{},label:"B"})})]}),0===d.length&&0===u.length&&(0,gt.jsxs)("div",{className:"block-editor-inserter__no-results",children:[(0,gt.jsx)(Tt.Z,{className:"block-editor-inserter__no-results-icon",icon:Lt.Z}),(0,gt.jsx)("p",{children:(0,k.__)("No results found.")})]})]})})]})}),a&&(0,gt.jsx)(Pt,{item:a})]})}));function qt(){return(0,gt.jsx)("div",{className:"edit-site-editor__inserter-panel",children:(0,gt.jsx)("div",{className:"edit-site-editor__inserter-panel-content",children:(0,gt.jsx)(Yt,{})})})}function Jt(){const{isSidebarOpened:e,selectedStep:t}=(0,_.Z)((e=>({isSidebarOpened:e(mt).isSidebarOpened,selectedStep:e(mt).getSelectedStep}))),{openSidebar:n,closeSidebar:r,toggleFeature:a}=(0,S.Z)(mt),{registerShortcut:i}=(0,S.Z)(Le.h);return(0,b.useEffect)((()=>{i({name:"mailpoet/automation-editor/toggle-fullscreen",category:"global",description:(0,k.__)("Toggle fullscreen mode."),keyCombination:{modifier:"secondary",character:"f"}}),i({name:"mailpoet/automation-editor/toggle-sidebar",category:"global",description:(0,k.__)("Show or hide the settings sidebar."),keyCombination:{modifier:"primaryShift",character:","}})}),[i]),(0,Le.bx)("mailpoet/automation-editor/toggle-fullscreen",(()=>{a("fullscreenMode")})),(0,Le.bx)("mailpoet/automation-editor/toggle-sidebar",(a=>{if(a.preventDefault(),e())r();else{const e=t()?$e:Ve;n(e)}})),null}var Qt=n(12518),Xt=(0,b.createElement)(x.Wj,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,b.createElement)(x.y$,{fillRule:"evenodd",d:"M10.289 4.836A1 1 0 0111.275 4h1.306a1 1 0 01.987.836l.244 1.466c.787.26 1.503.679 2.108 1.218l1.393-.522a1 1 0 011.216.437l.653 1.13a1 1 0 01-.23 1.273l-1.148.944a6.025 6.025 0 010 2.435l1.149.946a1 1 0 01.23 1.272l-.653 1.13a1 1 0 01-1.216.437l-1.394-.522c-.605.54-1.32.958-2.108 1.218l-.244 1.466a1 1 0 01-.987.836h-1.306a1 1 0 01-.986-.836l-.244-1.466a5.995 5.995 0 01-2.108-1.218l-1.394.522a1 1 0 01-1.217-.436l-.653-1.131a1 1 0 01.23-1.272l1.149-.946a6.026 6.026 0 010-2.435l-1.148-.944a1 1 0 01-.23-1.272l.653-1.131a1 1 0 011.217-.437l1.393.522a5.994 5.994 0 012.108-1.218l.244-1.466zM14.929 12a3 3 0 11-6 0 3 3 0 016 0z",clipRule:"evenodd"}));function en(e){let{sidebarKey:t}=e;const{openSidebar:n}=(0,S.Z)(mt),[r,a]=t===Ve?["Workflow (selected)","is-active"]:["Workflow",""],[i,s]=t===$e?["Step (selected)","is-active"]:["Step",""];return(0,gt.jsxs)("ul",{children:[(0,gt.jsx)("li",{children:(0,gt.jsx)(h.Z,{onClick:()=>n(Ve),className:`edit-site-sidebar__panel-tab ${a}`,"aria-label":r,"data-label":"Workflow",children:"Workflow"})}),(0,gt.jsx)("li",{children:(0,gt.jsx)(h.Z,{onClick:()=>n($e),className:`edit-site-sidebar__panel-tab ${s}`,"aria-label":i,"data-label":"Workflow",children:"Step"})})]})}var tn=n(21840);function nn(e){let{title:t,description:n,icon:r}=e;return(0,gt.jsxs)("div",{className:"block-editor-block-card",children:[(0,gt.jsx)(Dt,{icon:r}),(0,gt.jsxs)("div",{className:"block-editor-block-card__content",children:[(0,gt.jsx)("h2",{className:"block-editor-block-card__title",children:t}),(0,gt.jsx)("span",{className:"block-editor-block-card__description",children:n})]})]})}function rn(){const{selectedStep:e,selectedStepType:t}=(0,_.Z)((e=>({selectedStep:e(mt).getSelectedStep(),selectedStepType:e(mt).getSelectedStepType()})),[]);if(!e)return(0,gt.jsx)(tn.Z,{children:"No step selected."});if(!t)return(0,gt.jsx)(tn.Z,{children:"Unknown step type."});const n=t.edit;return(0,gt.jsxs)("div",{className:"block-editor-block-inspector",children:[(0,gt.jsx)(nn,{title:t.title,description:t.description,icon:t.icon}),(0,gt.jsx)(n,{}),(0,gt.jsxs)(tn.Z,{title:"Debug info",initialOpen:!1,children:[(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"ID:"})," ",e.id]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"Type:"})," ",e.type]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"Key:"})," ",e.key]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"Args:"})," ",JSON.stringify(e.args)]})]})]})}function an(){const{workflowData:e}=(0,_.Z)((e=>({workflowData:e(mt).getWorkflowData()})),[]);return(0,gt.jsxs)(tn.Z,{children:[(0,gt.jsx)("div",{children:(0,gt.jsx)("strong",{children:e.name})}),(0,gt.jsx)("br",{}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"ID:"})," ",e.id]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"Status:"})," ",e.status]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"Created:"})," ",new Date(Date.parse(e.created_at)).toLocaleString()]}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("strong",{children:"Updated:"})," ",new Date(Date.parse(e.updated_at)).toLocaleString()]})]})}const sn=Qt.Z.select({web:!0,native:!1});function on(e){const{keyboardShortcut:t,sidebarKey:n,showIconLabels:r,workflowName:a}=(0,_.Z)((e=>({keyboardShortcut:e(Le.h).getShortcutRepresentation("mailpoet/automation-editor/toggle-sidebar"),sidebarKey:e(se).getActiveComplementaryArea(We)??Ve,showIconLabels:e(mt).isFeatureActive("showIconLabels"),workflowName:e(mt).getWorkflowData().name})),[]);return(0,gt.jsxs)(ke,{identifier:n,header:(0,gt.jsx)(en,{sidebarKey:n}),closeLabel:(0,k.__)("Close settings"),headerClassName:"edit-site-sidebar__panel-tabs",title:(0,k.__)("Settings"),icon:Xt,className:"edit-site-sidebar",panelClassName:"edit-site-sidebar",smallScreenTitle:a||(0,k.__)("(no title)"),scope:We,toggleShortcut:t,isActiveByDefault:sn,showIconLabels:r,...e,children:[n===Ve&&(0,gt.jsx)(an,{}),n===$e&&(0,gt.jsx)(rn,{})]})}var ln=n(73763);const cn=(0,b.createContext)(void 0);function dn(){return(0,gt.jsx)("div",{className:"mailpoet-automation-editor-empty-workflow",children:"No workflow data."})}function un(e){let{onClick:t}=e;const n=(0,b.useContext)(cn);return(0,gt.jsx)(Rt.A,{state:n,role:"treeitem",className:"mailpoet-automation-editor-add-step-button",focusable:!0,onClick:e=>{e.stopPropagation();const n=e.target.closest("button");t(n)},children:(0,gt.jsx)(Tt.Z,{icon:xt.Z,size:16})})}function pn(){const{setInserterPopoverAnchor:e}=(0,Z.dispatch)(mt);return(0,gt.jsx)("div",{className:"mailpoet-automation-editor-separator",children:(0,gt.jsx)(un,{onClick:t=>e(t)})})}var mn=n(78869);function fn(){return(0,gt.jsxs)("svg",{viewBox:"0 0 24 18",xmlns:"http://www.w3.org/2000/svg",children:[(0,gt.jsx)("path",{d:"M16.1135 1.06667L22.6469 7.6C23.4635 8.3 23.4635 9.7 22.5302 10.5167L15.9969 17.05C15.6469 17.4 15.0635 17.6333 14.5968 17.6333C14.1302 17.6333 13.5468 17.4 13.1968 17.05L6.66352 10.5167C5.84685 9.7 5.84685 8.41667 6.66352 7.6L13.1968 1.06667C14.0135 0.25 15.2968 0.25 16.1135 1.06667Z"}),(0,gt.jsx)("path",{d:"M9.46352 1.41667L2.11352 8.76667C1.99685 8.88333 1.99685 9.11667 2.23018 9.11667L9.58018 16.4667L8.29685 17.75L0.946851 10.5167C0.130184 9.7 0.130184 8.41667 0.946851 7.6L8.29685 0.25L9.46352 1.41667Z"})]})}function hn(e){let{foreground:t,background:n,...r}=e;return(0,gt.jsx)("div",{className:"mailpoet-automation-colored-icon",style:{width:r.width,height:r.height,backgroundColor:n,fill:t},children:(0,gt.jsx)(g.Z,{...r})})}function gn(e){if("trigger"===e.type)return(0,gt.jsx)(hn,{foreground:"#2271b1",background:"#f0f6fc",width:"23px",height:"23px",icon:fn});const t=(0,Z.select)(mt).getStepType(e.key);return t?(0,gt.jsx)(hn,{width:"23px",height:"23px",foreground:t.foreground,background:t.background,icon:t.icon}):null}function vn(e){if("trigger"===e.type)return"Trigger";const t=(0,Z.select)(mt).getStepType(e.key);return t?t.title:""}function _n(e){if("mailpoet:segment:subscribed"===e.key)return"Subscribed to segment";const t=(0,Z.select)(mt).getStepType(e.key);return t?t.subtitle(e):null}function bn(e){let{step:t,isSelected:n}=e;const{openSidebar:r,selectStep:a}=(0,S.Z)(mt),i=(0,b.useContext)(cn),{batch:s}=(0,mn.Z)();return(0,gt.jsxs)(Rt.A,{state:i,role:"treeitem",className:"mailpoet-automation-editor-step "+(n?"selected-step":""),focusable:!0,onClick:()=>s((()=>{r($e),a(t)})),children:[(0,gt.jsx)("div",{className:"mailpoet-automation-editor-step-icon",children:gn(t)}),(0,gt.jsxs)("div",{children:[(0,gt.jsx)("div",{className:"mailpoet-automation-editor-step-title",children:vn(t)}),(0,gt.jsx)("div",{className:"mailpoet-automation-editor-step-subtitle",children:_n(t)})]})]},t.id)}function xn(){const{inserterPopoverAnchor:e}=(0,_.Z)((e=>({inserterPopoverAnchor:e(mt).getInserterPopoverAnchor()})),[]),{setInserterPopoverAnchor:t}=(0,Z.dispatch)(mt);return e?(0,gt.jsx)(v.Z,{anchorRect:e.getBoundingClientRect(),onClose:()=>t(void 0),children:(0,gt.jsx)(Yt,{})}):null}function wn(){const{workflowData:e,selectedStep:t}=(0,_.Z)((e=>({workflowData:e(mt).getWorkflowData(),selectedStep:e(mt).getSelectedStep()})),[]),n=(0,Ht.u)({orientation:"vertical",wrap:"horizontal",shift:!0}),r=(null==e?void 0:e.steps)??void 0,a=(0,b.useMemo)((()=>Object.values(r??{}).filter((e=>{let{type:t}=e;return"trigger"===t}))),[r]),i=(0,b.useMemo)((()=>{if(!r||a.length<1)return[];const e=[a[0]];for(;;){const t=e[e.length-1];if(!("next_step_id"in t)||!t.next_step_id||!r[t.next_step_id])break;e.push(r[t.next_step_id])}return e}),[a,r]);return e?(0,gt.jsx)(cn.Provider,{value:n,children:(0,gt.jsxs)(ln.b,{state:n,role:"tree","aria-orientation":"vertical",className:"mailpoet-automation-editor-workflow",children:[(0,gt.jsxs)("div",{className:"mailpoet-automation-editor-workflow-wrapper",children:[(0,gt.jsx)("div",{}),i.map(((e,n)=>(0,gt.jsxs)(b.Fragment,{children:[n>0&&(0,gt.jsx)(pn,{}),(0,gt.jsx)(bn,{step:e,isSelected:t&&e.id===t.id})]},e.id))),(0,gt.jsx)("div",{})]}),(0,gt.jsx)(xn,{})]})}):(0,gt.jsx)(dn,{})}var yn=n(93702),jn=n(9090),Sn=n(6258),kn=n(97873);function En(e){let{title:t,children:n}=e;return(0,gt.jsxs)("h2",{className:"components-panel__body-title mailpoet-automation-panel-plain-body-title",children:[(0,gt.jsx)("div",{className:"mailpoet-automation-panel-plain-body-title-text",children:t}),n]})}function Nn(e){return(0,gt.jsx)("div",{className:"mailpoet-automation-panel-plain-body-title-action",children:(0,gt.jsx)(h.Z,{...e})})}const Cn=[{label:"Hours",subtitle:e=>`Wait for ${e} ${1===e?"hour":"hours"}`,value:"HOURS"},{label:"Days",subtitle:e=>`Wait for ${e} ${1===e?"day":"days"}`,value:"DAYS"},{label:"Weeks",subtitle:e=>`Wait for ${e} ${1===e?"week":"weeks"}`,value:"WEEKS"}],An={key:"core:delay",group:"actions",title:"Delay",foreground:"#7F54B3",background:"#f7edf7",description:"Wait some time before proceeding with the steps below",subtitle:e=>{return e.args.delay&&e.args.delay_type?(t=e.args.delay_type,n=e.args.delay,Cn.reduce(((e,r)=>r.value!==t?e:r.subtitle(n)),"")):"Not set up yet.";var t,n},icon:function(){return(0,gt.jsx)("svg",{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:(0,gt.jsx)("path",{d:"M9.79683 0.666656C4.6635 0.666656 0.463501 4.86666 0.463501 9.99999C0.463501 15.1333 4.6635 19.3333 9.79683 19.3333C14.9302 19.3333 19.1302 15.1333 19.1302 9.99999C19.1302 4.86666 14.9302 0.666656 9.79683 0.666656ZM9.79683 17.4667C5.68083 17.4667 2.33017 14.116 2.33017 9.99999C2.33017 5.88399 5.68083 2.53332 9.79683 2.53332C13.9128 2.53332 17.2635 5.88399 17.2635 9.99999C17.2635 14.116 13.9128 17.4667 9.79683 17.4667ZM10.2635 5.33332H8.8635V10.9333L13.7168 13.92L14.4635 12.7067L10.2635 10.1867V5.33332Z"})})},edit:function(){const{selectedStep:e}=(0,_.Z)((e=>({selectedStep:e(mt).getSelectedStep()})),[]);return(0,gt.jsxs)(tn.Z,{opened:!0,children:[(0,gt.jsx)(En,{title:"Wait for"}),(0,gt.jsxs)(jn.Z,{align:"top",children:[(0,gt.jsx)(Sn.Z,{style:{flex:"1 1 0"},children:(0,gt.jsx)(Pe.Z,{label:"",type:"number",placeholder:"Number",value:e.args.delay??"",onChange:t=>{const n=0===t.length||parseInt(t,10)<1?1:parseInt(t,10);(0,Z.dispatch)(mt).updateStepArgs(e.id,"delay",n)}})}),(0,gt.jsx)(Sn.Z,{style:{flex:"1 1 0"},children:(0,gt.jsx)(kn.Z,{label:"",value:e.args.delay_type??"HOURS",options:Cn,onChange:t=>(0,Z.dispatch)(mt).updateStepArgs(e.id,"delay_type",t)})})]})]})}};var Zn=n(52405),In=n(9578);function Tn(e){let{centered:t,variant:n,...r}=e;return(0,gt.jsx)(h.Z,{className:p()(["sidebar-primary"===n?"mailpoet-automation-button-sidebar-primary":"",t?"mailpoet-automation-button-centered":""]),variant:"sidebar-primary"===n?"primary":n,...r})}var Ln=n(62668);function Dn(){var e;const[t,n]=(0,b.useState)(!1),{selectedStep:r,workflowId:a,workflowSaved:i}=(0,_.Z)((e=>({selectedStep:e(mt).getSelectedStep(),workflowId:e(mt).getWorkflowData().id,workflowSaved:e(mt).getSelectedStep()})),[]),s=null==r||null===(e=r.args)||void 0===e?void 0:e.email_id,o=r.id,l=(0,b.useCallback)((async()=>{n(!0);const e=await Ln.x.Ajax.post({api_version:window.mailpoet_api_version,endpoint:"newsletters",action:"create",data:{type:"automation",subject:"",options:{workflowId:a,workflowStepId:o}}});(0,Z.dispatch)(mt).updateStepArgs(o,"email_id",parseInt(e.data.id,10)),(0,Z.dispatch)(mt).save()}),[a,o]);return(0,b.useEffect)((()=>{s&&i&&(window.location.href=`admin.php?page=mailpoet-newsletter-editor&id=${s}`)}),[s,i]),(0,gt.jsx)(Tn,{variant:"sidebar-primary",centered:!0,icon:xt.Z,onClick:l,isBusy:t,disabled:t,children:"Design email"})}var Pn=n(3386),Rn=n(11699);const Mn=Pn.ZP;function Fn(e){let{emailId:t}=e;const[n,r]=(0,b.useState)();return(0,b.useEffect)((()=>{(async()=>{var e;const n=await Rn.G.post({api_version:window.mailpoet_api_version,endpoint:"newsletters",action:"get",data:{id:t}});null!=n&&null!==(e=n.data)&&void 0!==e&&e.thumbnail_url&&r(n.data.thumbnail_url)})()}),[t]),(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)("div",{className:"mailpoet-automation-thumbnail-box",children:n?(0,gt.jsx)("div",{className:"mailpoet-automation-thumbnail-wrapper",children:(0,gt.jsx)("img",{className:"mailpoet-automation-thumbnail-image",src:n,alt:"Email thumbnail"})}):(0,gt.jsx)(Mn,{className:"mailpoet-automation-thumbnail-spinner"})}),(0,gt.jsxs)("div",{className:"mailpoet-automation-thumbnail-buttons",children:[(0,gt.jsx)(Tn,{variant:"sidebar-primary",centered:!0,href:`?page=mailpoet-newsletter-editor&id=${t}`,children:"Edit content"}),(0,gt.jsx)(Tn,{variant:"secondary",centered:!0,children:"Preview"})]})]})}function On(e){return(0,gt.jsx)(Zn.Z,{...e,onChange:t=>e.onChange(t.replaceAll(/(\r?\n)+/g," ")),onKeyDown:t=>{"Enter"===t.key&&t.preventDefault(),e.onKeyDown&&e.onKeyDown(t)}})}function Wn(){const{selectedStep:e}=(0,_.Z)((e=>({selectedStep:e(mt).getSelectedStep()})),[]);return(0,gt.jsxs)(tn.Z,{opened:!0,children:[(0,gt.jsx)(En,{title:"Email",children:(0,gt.jsx)(Nn,{children:(0,gt.jsx)(Tt.Z,{icon:In.Z,size:16})})}),(0,gt.jsx)(Pe.Z,{label:"“From” name",placeholder:"John Doe",value:e.args.sender_name??"",onChange:t=>(0,Z.dispatch)(mt).updateStepArgs(e.id,"sender_name",t)}),(0,gt.jsx)(Pe.Z,{type:"email",label:"“From” email address",placeholder:"you@domain.com",value:e.args.sender_address??"",onChange:t=>(0,Z.dispatch)(mt).updateStepArgs(e.id,"sender_address",t)}),(0,gt.jsx)(On,{label:"Subject",placeholder:"Type in subject…",value:e.args.subject??"",onChange:t=>(0,Z.dispatch)(mt).updateStepArgs(e.id,"subject",t)}),(0,gt.jsx)(On,{label:"Preheader",placeholder:"Type in preheader…",value:e.args.preheader??"",onChange:t=>(0,Z.dispatch)(mt).updateStepArgs(e.id,"preheader",t)}),(0,gt.jsx)("div",{className:"mailpoet-automation-email-content-separator"}),(0,gt.jsx)(En,{title:"Email content"}),e.args.email_id?(0,gt.jsx)(Fn,{emailId:e.args.email_id}):(0,gt.jsx)(Dn,{})]})}var Vn=n(58897),$n=n(77333);function Bn(e){let{children:t,...n}=e;return(0,gt.jsxs)($n.Z,{className:"mailpoet-premium-modal",title:(0,k.__)("Upgrade to premium","mailpoet"),closeButtonLabel:(0,k.__)("Cancel","mailpoet"),...n,children:[(0,gt.jsx)("div",{children:(0,k.__)("Google Analytics tracking is not available in the free version of the MailPoet plugin. Please upgrade to the Premium version.","mailpoet")}),(0,gt.jsxs)("div",{className:"mailpoet-premium-modal-footer",children:[(0,gt.jsx)(h.Z,{variant:"tertiary",onClick:n.onRequestClose,children:(0,k.__)("Cancel","mailpoet")}),(0,gt.jsx)(h.Z,{variant:"primary",children:(0,k.__)("Upgrade","mailpoet")})]})]})}var Un=n(34517);function zn(){var e;const{selectedStep:t}=(0,_.Z)((e=>({selectedStep:e(mt).getSelectedStep()})),[]),n=void 0!==(null===(e=t.args)||void 0===e?void 0:e.ga_campaign),r=Un.Hooks.applyFilters("mailpoet.automation.send_email.google_analytics_panel",(0,gt.jsx)(Bn,{onRequestClose:()=>(0,Z.dispatch)(mt).updateStepArgs(t.id,"ga_campaign",void 0),children:(0,k.__)("Google Analytics tracking is not available in the free version of the MailPoet plugin.","mailpoet")}));return(0,gt.jsxs)(tn.Z,{title:"Google analytics",initialOpen:!1,children:[(0,gt.jsx)(Vn.Z,{label:"Enable custom GA tracking",checked:n,onChange:e=>(0,Z.dispatch)(mt).updateStepArgs(t.id,"ga_campaign",e?"":void 0)}),n&&r]})}function Hn(){const{selectedStep:e}=(0,_.Z)((e=>({selectedStep:e(mt).getSelectedStep()})),[]),t=e.args.reply_to_name,n=e.args.reply_to_address,r=void 0!==t||void 0!==n;return(0,gt.jsxs)(tn.Z,{title:"Reply to",initialOpen:!1,children:[(0,gt.jsx)(Vn.Z,{label:"Use different email address for getting replies to the email",checked:r,onChange:t=>{(0,Z.dispatch)(mt).updateStepArgs(e.id,"reply_to_name",t?"":void 0),(0,Z.dispatch)(mt).updateStepArgs(e.id,"reply_to_address",t?"":void 0)}}),r&&(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(Pe.Z,{label:"“Reply to” name",placeholder:"John Doe",value:t??"",onChange:t=>(0,Z.dispatch)(mt).updateStepArgs(e.id,"reply_to_name",t)}),(0,gt.jsx)(Pe.Z,{type:"email",label:"“Reply to” email address",placeholder:"you@domain.com",value:n??"",onChange:t=>(0,Z.dispatch)(mt).updateStepArgs(e.id,"reply_to_address",t)})]})]})}const Gn={key:"mailpoet:send-email",group:"actions",title:"Send email",description:"An email will be sent to subscriber",subtitle:e=>`Email ID ${e.args.email_id}`,foreground:"#996800",background:"#FCF9E8",icon:function(){return(0,gt.jsx)("svg",{viewBox:"0 0 16 12",xmlns:"http://www.w3.org/2000/svg",children:(0,gt.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2.73578 1.5L8 6.01219L13.2642 1.5H2.73578ZM14.5 2.41638L8.48809 7.56944L8 7.98781L7.51191 7.56944L1.5 2.41638V10C1.5 10.2761 1.72386 10.5 2 10.5H14C14.2761 10.5 14.5 10.2761 14.5 10V2.41638ZM0 2C0 0.89543 0.89543 0 2 0H14C15.1046 0 16 0.895431 16 2V10C16 11.1046 15.1046 12 14 12H2C0.895431 12 0 11.1046 0 10V2Z"})})},edit:function(){return(0,gt.jsxs)(gt.Fragment,{children:[(0,gt.jsx)(Wn,{}),(0,gt.jsx)(Hn,{}),(0,gt.jsx)(zn,{})]})}};function Kn(){const{isFullscreenActive:e,isInserterOpened:t,isSidebarOpened:n,showIconLabels:r}=(0,_.Z)((e=>({isFullscreenActive:e(mt).isFeatureActive("fullscreenMode"),isInserterOpened:e(mt).isInserterSidebarOpened(),isSidebarOpened:e(mt).isSidebarOpened(),showIconLabels:e(mt).isFeatureActive("showIconLabels")})),[]),a=p()("interface-interface-skeleton",{"is-sidebar-opened":n,"show-icon-labels":r});return(0,gt.jsx)(Le.vn,{children:(0,gt.jsxs)(f.zt,{children:[(0,gt.jsx)(Ee,{isActive:e}),(0,gt.jsx)(Jt,{}),(0,gt.jsx)(on,{}),(0,gt.jsx)(Ae,{className:a,drawer:e&&(0,gt.jsx)("div",{className:"edit-site-navigation-toggle",children:(0,gt.jsx)(h.Z,{className:"edit-site-navigation-toggle__button has-icon",href:"admin.php?page=mailpoet-automation",children:(0,gt.jsx)(g.Z,{size:36,icon:w})})}),header:(0,gt.jsx)(Zt,{}),content:(0,gt.jsx)(wn,{}),sidebar:(0,gt.jsx)(ke.Slot,{scope:We}),secondarySidebar:t?(0,gt.jsx)(qt,{}):null}),(0,gt.jsx)(v.Z.Slot,{})]})})}window.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("mailpoet_automation_editor");e&&((0,yn.qN)(),ft(An),ft(Gn),m.render((0,gt.jsx)(Kn,{}),e))}))},65311:function(e){e.exports=jQuery}},function(e){e.O(0,[351],(function(){return 21918,e(e.s=21918)})),e.O()}]);