!function(e){jQuery.fn.flexdatalist=function(t,i){"use strict";var a=function(t,i){t.each(function(){var t=e(this),a=t.data(),r=a.flexdatalist,s=a.aliascontainer;s&&(t.removeClass("flexdatalist-set").attr({style:null,tabindex:null}).val(r&&r.originalValue&&!i?r.originalValue:"").removeData("flexdatalist").removeData("aliascontainer").off(),s.remove())})};if("string"==typeof t&&"reset"!==t){if(void 0!==this[0].fvalue){var r=this[0];if("destroy"===t)a(this,i);else if("value"===t){if(void 0===i)return r.fvalue.get();r.fvalue.set(i)}else if("add"===t){if(void 0===i)return r.debug("Missing value to add!");r.fvalue.add(i)}else if("toggle"===t){if(void 0===i)return r.debug("Missing value to toggle!");r.fvalue.toggle(i)}else if("remove"===t){if(void 0===i)return r.debug("Missing value to remove!");r.fvalue.remove(i)}else if("disabled"===t){if(void 0===i)return r.fdisabled();r.fdisabled(i)}else if("string"==typeof t){if(void 0===i)return r.options.get(t);r.options.set(t,i)}return this}t={_option:i}}this.length>0&&void 0!==this[0].fvalue&&a(this);var s=e.extend({url:null,data:[],params:{},relatives:null,chainedRelatives:!1,cache:!0,cacheLifetime:60,minLength:2,groupBy:!1,selectionRequired:!1,focusFirstResult:!1,textProperty:null,valueProperty:null,visibleProperties:[],iconProperty:"thumb",searchIn:["label"],searchContain:!1,searchEqual:!1,searchByWord:!1,searchDisabled:!1,searchDelay:300,normalizeString:null,multiple:null,disabled:null,maxShownResults:100,removeOnBackspace:!0,noResultsText:'No results found for "{keyword}"',toggleSelected:!1,allowDuplicateValues:!1,redoSearchOnFocus:!0,requestType:"get",requestContentType:"x-www-form-urlencoded",resultsProperty:"results",keywordParamName:"keyword",limitOfValues:0,valuesSeparator:",",debug:!0},t);return this.each(function(t){var i=e(this),a=this,r=null,n=[],l="flex"+t,o=null,u=null;this.init=function(){var e=this.options.init();this.set.up(),o.on("focusin",function(e){a.action.redoSearchFocus(e),a.action.showAllResults(e),u&&u.addClass("focus")}).on("input keydown",function(e){9===a.keyNum(e)&&a.results.remove(),a.action.keypressValue(e,188),a.action.backSpaceKeyRemove(e)}).on("input keyup",function(e){a.action.keypressValue(e,13),a.action.keypressSearch(e),a.action.copyValue(e),a.action.backSpaceKeyRemove(e),a.action.showAllResults(e),a.action.clearValue(e),a.action.removeResults(e),a.action.inputWidth(e)}).on("focusout",function(e){u&&u.removeClass("focus"),a.action.clearText(e),a.action.clearValue(e)}),window.onresize=function(e){a.position()},this.cache.gc(),e.selectionRequired&&a.fvalue.clear(!0,!0),this.fvalue._load(e.originalValue,function(t,r){a.fdisabled(e.disabled),i.trigger("init:flexdatalist",[e])},!0)},this.action={keypressValue:function(e,t){var i=a.keyNum(e),r=o[0].value,s=a.options.get();if(r.length>0&&i===t&&!s.selectionRequired&&s.multiple){r=o[0].value;e.preventDefault(),a.fvalue.extract(r),a.results.remove()}},keypressSearch:function(e){var t=a.keyNum(e),i=o.val(),s=i.length,n=a.options.get();clearTimeout(r),(!t||13!==t&&(t<37||t>40))&&(r=setTimeout(function(){(0===n.minLength&&s>0||n.minLength>0&&s>=n.minLength)&&a.data.load(function(e){a.search.get(i,e,function(e){a.results.show(e)})})},n.searchDelay))},redoSearchFocus:function(e){var t=a.fvalue.get(),i=a.options.get(),r=o.val();i.redoSearchOnFocus&&(r.length>0&&i.multiple||r.length>0&&0===t.length)&&this.keypressSearch(e)},copyValue:function(e){if(13!==a.keyNum(e)){var t=o.val(),i=a.fvalue.get(!0),r=a.options.get();r.multiple||r.selectionRequired||t.length===i.length||a.fvalue.extract(t)}},backSpaceKeyRemove:function(e){var t=a.options.get();if(t.removeOnBackspace&&t.multiple){var i=o.val(),r=o.data("_remove");8===a.keyNum(e)&&(0===i.length?r?(a.fvalue.remove(r),o.data("_remove",null)):(console.log("remove!"),o.data("_remove",o.parents("li:eq(0)").prev())):o.data("_remove",null))}},showAllResults:function(t){var i=o.val();""===(i=e.trim(i))&&0===a.options.get("minLength")&&a.data.load(function(e){a.results.show(e)})},inputWidth:function(e){if(a.options.get().multiple){var t=o.val(),r=parseInt(o.css("fontSize").replace("px","")),s=i.innerWidth(),n=(t.length+1)*r;n>=40&&n<=s&&(o[0].style.width=n+"px")}},clearText:function(e){var t=a.fvalue.get(),i=a.options.get();!i.multiple&&i.selectionRequired&&0===t.length&&(o[0].value="")},clearValue:function(e){a.fvalue.get();var t=o.val(),i=a.options.get();!i.multiple&&i.selectionRequired&&t.length<=i.minLength&&a.fvalue.clear()},removeResults:function(e){a.fvalue.get();var t=o.val(),i=a.options.get();i.minLength>0&&t.length<i.minLength&&a.results.remove()}},this.set={up:function(){o=this.alias(),a.options.get("multiple")?u=this.multipleInput(o):o.insertAfter(i),i.attr("autofocus")&&o.focus(),i.data("aliascontainer",u||o).addClass("flexdatalist flexdatalist-set").css({position:"absolute",top:-14e3,left:-14e3}).attr("tabindex",-1);var t=i.attr("id"),r=o.attr("id");e('label[for="'+t+'"]').attr("for",r),this.chained()},alias:function(){var t=i.attr("id")?i.attr("id")+"-flexdatalist":l;return e('<input type="text">').attr({class:i.attr("class"),name:i.attr("name")?"flexdatalist-"+i.attr("name"):null,id:t,placeholder:i.attr("placeholder")}).addClass("flexdatalist-alias "+t).removeClass("flexdatalist").attr("autocomplete","off")},multipleInput:function(t){return u=e('<ul tabindex="1">').addClass("flexdatalist-multiple "+l).css({"border-color":i.css("border-left-color"),"border-width":i.css("border-left-width"),"border-style":i.css("border-left-style"),"border-radius":i.css("border-top-left-radius"),"background-color":i.css("background-color")}).insertAfter(i).click(function(){e(this).find("input").focus()}),e('<li class="input-container">').addClass("flexdatalist-multiple-value").append(t).appendTo(u),u},chained:function(){var t=a.options.get();if(t.relatives&&t.chainedRelatives){var i=function(i){t.relatives.each(function(){var t=a.isEmpty(e(this).val()),i=a.isEmpty(a.value);!t&&i||a.fvalue.clear(),a.fdisabled(t)})};t.relatives.on("change",function(){i()}),i()}}},this.fvalue={get:function(e){var t=a.value;return!a.options.get().multiple&&!this.isJSON()||e?t:this.toObj(t)},set:function(e,t){return a.fdisabled()||(t||this.clear(!0),this._load(e)),i},add:function(e){return a.options.get("multiple")&&this.set(e,!0),this},toggle:function(e){return a.fdisabled()||this.multiple.toggle(e),this},remove:function(t){if(!a.fdisabled()){t=this.toObj(t),i.trigger("before:flexdatalist.remove",[t]);var r=[];if(e.isArray(t))e.each(t,function(e,t){var i=a.fvalue.multiple.remove(t);i&&r.push(i)});else{var s=this.multiple.remove(t);s&&r.push(s)}i.trigger("after:flexdatalist.remove",[t,r]).trigger("change:flexdatalist",[r,a.options.get()]).trigger("change")}return this},_load:function(t,i,r){var s=a.options.get().valueProperty,n=this.toStr(t),l=this.get(!0);if(i=i||e.noop,0!=n.length||0!=l.length){if(t=this.toObj(t),!a.isEmpty(t)&&!a.isEmpty(s)&&"*"!==s)return a.isObject(s)||(s=s.split(",")),void a.data.load(function(r){a.isObject(t)?e.isArray(t)||(t=[t]):t=t.split(",");for(var n=[],l=0;l<t.length;l++)for(var o=t[l],u=0;u<r.length;u++)for(var f=r[u],c=0;c<s.length;c++){var d=s[c];o=a.isDefined(o,d)?o[d]:o;a.isDefined(f,d)&&o===f[d]&&n.push(f)}n.length>0&&a.fvalue.extract(n,!0),i(t)},t);i(t),a.fvalue.extract(t,r)}else i(t)},extract:function(t,r){var s=a.options.get(),n=[];r||i.trigger("before:flexdatalist.value",[t,s]),e.isArray(t)?e.each(t,function(e,t){n.push(a.fvalue._extract(t))}):n=a.fvalue._extract(t),r||i.trigger("after:flexdatalist.value",[n,s]).trigger("change:flexdatalist",[n,s]).trigger("change")},_extract:function(e){var t=this.text(e),i=this.value(e);a.value;if(a.options.get().multiple){if(!a.isEmpty(i)){if(a.isDup(i))return;n.push(i),this.multiple.add(i,t)}}else this.single(i,t);return{value:i,text:t}},single:function(e,t){t&&t!==o.val()&&(o[0].value=t),a.value=e},multiple:{add:function(t,i){var r=this,s=this.li(t,i);a.options.get();s.click(function(){r.toggle(e(this))}).find(".fdl-remove").click(function(){a.fvalue.remove(e(this).parent())}),this.push(t),o[0].value="",this.checkLimit()},push:function(e,t){var i=a.fvalue.get();e=a.fvalue.toObj(e),i.push(e),e=a.fvalue.toStr(i),a.value=e},toggle:function(e){var t=a.options.get();if(t.toggleSelected){var r=this.findLi(e);if(r){var s=r.index(),n=r.data(),l=r.hasClass("disabled")?"enable":"disable",o=a.fvalue.get(),u=[{value:n.value,text:n.text,action:l},t];if(i.trigger("before:flexdatalist.toggle",u),"enable"===l){var f=r.data("value");o.splice(s,0,f),r.removeClass("disabled")}else o.splice(s,1),r.addClass("disabled");o=a.fvalue.toStr(o),a.value=o,i.trigger("after:flexdatalist.toggle",u).trigger("change:flexdatalist",u).trigger("change")}}},remove:function(e){var t=this.findLi(e);if(t){var i=a.fvalue.get(),r=t.index(),s=t.data(),l=(a.options.get(),{value:s.value,text:s.text});return i.splice(r,1),i=a.fvalue.toStr(i),a.value=i,t.remove(),a.fvalue.multiple.checkLimit(),n.splice(r,1),l}},removeAll:function(){var e=a.fvalue.get(),t=a.options.get();i.trigger("before:flexdatalist.remove.all",[e,t]),u.find("li:not(.input-container)").remove(),a.value="",n=[],i.trigger("after:flexdatalist.remove.all",[e,t])},li:function(t,i){var r=u.find("li.input-container");return e("<li>").addClass("value"+(a.options.get("toggleSelected")?" toggle":"")).append('<span class="text">'+i+"</span>").append('<span class="fdl-remove">&times;</span>').data({text:i,value:a.fvalue.toObj(t)}).insertBefore(r)},checkLimit:function(){var e=a.options.get("limitOfValues");if(e>0){var t=u.find("li.input-container");e==n.length?t.hide():t.show()}},findLi:function(t){if(t instanceof jQuery)0===t.length&&(t=null);else{var i=t;t=null,u.find("li:not(.input-container)").each(function(){var a=e(this);if(a.data("value")===i)return t=a,!1})}return t},isEmpty:function(){return this.get().length>0}},value:function(t){var i=t,r=a.options.get(),s=r.valueProperty;if(a.isObject(t))if(this.isJSON()||this.isMixed())if(delete t.name_highlight,e.isArray(s)){for(var n={},l=0;l<s.length;l++)a.isDefined(t,s[l])&&(n[s[l]]=t[s[l]]);i=this.toStr(n)}else i=this.toStr(t);else i=a.isDefined(t,s)?t[s]:a.isDefined(t,r.searchIn[0])?t[r.searchIn[0]]:null;return i},text:function(t){var i=t,r=a.options.get();return a.isObject(t)&&(i=t[r.searchIn[0]],i=a.isDefined(t,r.textProperty)?t[r.textProperty]:this.placeholders.replace(t,r.textProperty,i)),e("<div>").html(i).text()},placeholders:{replace:function(t,i,r){if(a.isObject(t)&&"string"==typeof i){var s=this.parse(i);if(!a.isEmpty(t)&&s)return e.each(s,function(e,r){a.isDefined(t,r)&&(i=i.replace(e,t[r]))}),i}return r},parse:function(e){var t=e.match(/\{.+?\}/g);if(t){var i={};return t.map(function(e){i[e]=e.slice(1,-1)}),i}return!1}},clear:function(e,t){var r=a.value,s=a.options.get();return s.multiple&&this.multiple.removeAll(),a.value="",""===r||t||i.trigger("change:flexdatalist",[{value:"",text:""},s]).trigger("change"),e&&(o[0].value=""),n=[],this},toObj:function(t){if("object"!=typeof t){var i=a.options.get();a.isEmpty(t)||!a.isDefined(t)?t=i.multiple?[]:this.isJSON()?{}:"":this.isCSV()?(t=t.toString().split(i.valuesSeparator),t=e.map(t,function(t){return e.trim(t)})):(this.isMixed()||this.isJSON())&&this.isJSON(t)?t=JSON.parse(t):"number"==typeof t&&(t=t.toString())}return t},toStr:function(t){return"string"!=typeof t&&(a.isEmpty(t)||!a.isDefined(t)?t="":"number"==typeof t?t=t.toString():this.isCSV()?t=t.join(a.options.get("valuesSeparator")):(this.isJSON()||this.isMixed())&&(t=JSON.stringify(t))),e.trim(t)},isJSON:function(e){if(void 0!==e){if(a.isObject(e))e=JSON.stringify(e);else if("string"!=typeof e)return!1;return 0===e.indexOf("{")||0===e.indexOf("[{")}var t=a.options.get().valueProperty;return a.isObject(t)||"*"===t},isMixed:function(){var e=a.options.get();return!e.selectionRequired&&"*"===e.valueProperty},isCSV:function(){return!this.isJSON()&&a.options.get("multiple")}},this.data={load:function(e,t){var a=this,r=[];i.trigger("before:flexdatalist.data"),this.url(function(t){r=r.concat(t),a.static(function(t){r=r.concat(t),a.datalist(function(t){r=r.concat(t),i.trigger("after:flexdatalist.data",[r]),e(r)})})},t)},static:function(e){var t=a.options.get();if("string"==typeof t.data){var i=t.data,r=a.cache.read(i,!0);if(r)return void e(r);this.remote({url:i,success:function(r){t.data=r,e(r),a.cache.write(i,r,t.cacheLifetime,!0)}})}else"object"!=typeof t.data&&(t.data=[]),e(t.data)},datalist:function(t){var r=i.attr("list"),s=[];a.isEmpty(r)||e("#"+r).find("option").each(function(){var t=e(this),i=t.val(),a=t.text();s.push({label:a.length>0?a:i,value:i})}),t(s)},url:function(t,i){var r=o.val(),s=a.options.get(),n=s.keywordParamName,l=a.fvalue.get(),u=this.relativesData();if(a.isEmpty(s.url))return t([]);var f={};"post"===s.requestType&&(e.each(s,function(e,t){0!=e.indexOf("_")&&"data"!=e&&(f[e]=t)}),delete f.relatives);var c=a.cache.keyGen({relative:u,load:i,keyword:r,contain:s.searchContain},s.url),d=a.cache.read(c,!0);if(d)t(d);else{var h=e.extend(u,s.params,{load:i,contain:s.searchContain,selected:l,original:s.originalValue,options:f});h[n]=r,this.remote({url:s.url,data:h,success:function(e){o.val().length>=r.length&&t(e),a.cache.write(c,e,s.cacheLifetime,!0)}})}},remote:function(t){var r=this,s=a.options.get();i.hasClass("flexdatalist-loading")||(i.addClass("flexdatalist-loading"),"json"===s.requestContentType&&(t.data=JSON.stringify(t.data)),e.ajax(e.extend({type:s.requestType,dataType:"json",contentType:"application/"+s.requestContentType+"; charset=UTF-8",complete:function(){i.removeClass("flexdatalist-loading")}},t,{success:function(e){e=r.extractRemoteData(e),t.success(e)}})))},extractRemoteData:function(t){var i=a.options.get(),r=a.isDefined(t,i.resultsProperty)?t[i.resultsProperty]:t;return"string"==typeof r&&0===r.indexOf("[{")&&(r=JSON.parse(r)),r&&r.options&&a.options.set(e.extend({},i,r.options)),a.isObject(r)?r:[]},relativesData:function(){var t=a.options.get("relatives"),i={};return t&&(i.relatives={},t.each(function(){var t=e(this),a=t.attr("name").split("][").join("-").split("]").join("-").split("[").join("-").replace(/^\|+|\-+$/g,"");i.relatives[a]=t.val()})),i}},this.search={get:function(e,t,r){if(a.options.get().searchDisabled)s=t;else{var s=a.cache.read(e);if(!s){if(i.trigger("before:flexdatalist.search",[e,t]),!a.isEmpty(e)){s=[];for(var n=this.split(e),l=0;l<t.length;l++){var o=t[l];a.isDup(o)||(o=this.matches(o,n))&&s.push(o)}}a.cache.write(e,s,2),i.trigger("after:flexdatalist.search",[e,t,s])}}r(s)},matches:function(t,i){var r=e.extend({},t),s=[],n=a.options.get(),l=n.searchIn;if(i.length>0)for(var o=0;o<l.length;o++){var u=l[o];if(a.isDefined(t,u)&&t[u]){for(var f=t[u].toString(),c=f,d=this.split(f),h=0;h<i.length;h++){var v=i[h];this.find(v,d)&&(s.push(v),c=this.highlight(v,c))}c!==f&&(r[u+"_highlight"]=this.highlight(c))}}return!(0===s.length||n.searchByWord&&s.length<i.length-1)&&r},highlight:function(e,t){return t?t.replace(new RegExp(e,a.options.get("searchContain")?"ig":"i"),"|:|$&|::|"):(e=e.split("|:|").join('<span class="highlight">')).split("|::|").join("</span>")},find:function(e,t){for(var i=a.options.get(),r=0;r<t.length;r++){var s=t[r];if(s=this.normalizeString(s),e=this.normalizeString(e),i.searchEqual)return s==e;if(i.searchContain?s.indexOf(e)>=0:0===s.indexOf(e))return!0}return!1},split:function(t){if("string"==typeof t&&(t=[e.trim(t)]),a.options.get("searchByWord"))for(var i=0;i<t.length;i++){var r=e.trim(t[i]);if(r.indexOf(" ")>0){var s=r.split(" ");e.merge(t,s)}}return t},normalizeString:function(e){if("string"==typeof e){var t=a.options.get("normalizeString");return"function"==typeof t&&(e=t(e)),e.toUpperCase()}return e}},this.results={show:function(t){var r=this,s=a.options.get();if(this.remove(!0),t)if(0!==t.length){var n=this.container();s.groupBy?(t=this.group(t),Object.keys(t).forEach(function(i,l){var o=t[i],u=s.groupBy,f=a.results.highlight(o[0],u,i);e("<li>").addClass("group").append(e("<span>").addClass("group-name").html(f)).append(e("<span>").addClass("group-item-count").text(" "+o.length)).appendTo(n);r.items(o,n)})):this.items(t,n);var l=n.find("li:not(.group)");l.on("click",function(t){var n=e(this).data("item");n&&(a.fvalue.extract(n),r.remove(),i.trigger("select:flexdatalist",[n,s]))}).hover(function(){l.removeClass("active"),e(this).addClass("active").trigger("active:flexdatalist.results",[e(this).data("item")])},function(){e(this).removeClass("active")}),s.focusFirstResult&&l.filter(":first").addClass("active")}else this.empty(s.noResultsText)},empty:function(t){if(!a.isEmpty(t)){var i=this.container(),r=o.val();t=t.split("{keyword}").join(r),e("<li>").addClass("item no-results").append(t).appendTo(i)}},items:function(e,t){var r=a.options.get("maxShownResults");i.trigger("show:flexdatalist.results",[e]);for(var s=0;s<e.length&&!(r>0&&r===s);s++)this.item(e[s]).appendTo(t);i.trigger("shown:flexdatalist.results",[e])},item:function(t){for(var i=e("<li>").data("item",t).addClass("item"),r=a.options.get(),s=r.visibleProperties,n=0;n<s.length;n++){var l=s[n];if(l.indexOf("{")>-1){var o=a.fvalue.placeholders.replace(t,l),u=a.fvalue.placeholders.parse(l);f=e("<span>").addClass("item item-"+Object.values(u).join("-")).html(o+" ").appendTo(i)}else{if(r.groupBy&&r.groupBy===l||!a.isDefined(t,l))continue;var f={};if(l===r.iconProperty)f=e("<img>").addClass("item item-"+l).attr("src",t[l]);else{var c=a.results.highlight(t,l);f=e("<span>").addClass("item item-"+l).html(c+" ")}}f.appendTo(i)}return i},container:function(){var t=i;u&&(t=u);var r=e("ul.flexdatalist-results");return 0===r.length&&(r=e("<ul>").addClass("flexdatalist-results ").appendTo("body").attr("id",o.attr("id")+"-results").css({"border-color":t.css("border-left-color"),"border-width":"1px","border-bottom-left-radius":t.css("border-bottom-left-radius"),"border-bottom-right-radius":t.css("border-bottom-right-radius")}).data({target:u||o,input:i}),a.position(o)),r},group:function(e){for(var t=[],i=a.options.get("groupBy"),r=0;r<e.length;r++){var s=e[r];if(a.isDefined(s,i)){var n=s[i];a.isDefined(t,n)||(t[n]=[]),t[n].push(s)}}return t},highlight:function(e,t,i){return a.isDefined(e,t+"_highlight")?e[t+"_highlight"]:a.isDefined(e,t)?e[t]:i},remove:function(t){var a="ul.flexdatalist-results";t&&(a="ul.flexdatalist-results li"),i.trigger("remove:flexdatalist.results"),e(a).remove(),i.trigger("removed:flexdatalist.results")}},this.cache={write:function(e,t,i,r){if(a.cache.isSupported()){e=this.keyGen(e,void 0,r);var s={value:t,timestamp:a.unixtime(),lifetime:i||!1};localStorage.setItem(e,JSON.stringify(s))}},read:function(e,t){if(a.cache.isSupported()){e=this.keyGen(e,void 0,t);var i=localStorage.getItem(e);if(i){var r=JSON.parse(i);if(!this.expired(r))return r.value;localStorage.removeItem(e)}}return null},delete:function(e,t){a.cache.isSupported()&&(e=this.keyGen(e,void 0,t),localStorage.removeItem(e))},clear:function(){if(a.cache.isSupported()){for(var e in localStorage)(e.indexOf(l)>-1||e.indexOf("global")>-1)&&localStorage.removeItem(e);localStorage.clear()}},gc:function(){if(a.cache.isSupported())for(var e in localStorage)if(e.indexOf(l)>-1||e.indexOf("global")>-1){var t=localStorage.getItem(e);t=JSON.parse(t),this.expired(t)&&localStorage.removeItem(e)}},isSupported:function(){if(a.options.get("cache"))try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}return!1},expired:function(e){if(e.lifetime){var t=a.unixtime()-e.timestamp;return e.lifetime<=t}return!1},keyGen:function(e,t,i){"object"==typeof e&&(e=JSON.stringify(e));var a,r,s=void 0===t?2166136261:t;for(a=0,r=e.length;a<r;a++)s^=e.charCodeAt(a),s+=(s<<1)+(s<<4)+(s<<7)+(s<<8)+(s<<24);return(i?"global":l)+("0000000"+(s>>>0).toString(16)).substr(-8)}},this.options={init:function(){var t=e.extend({},s,i.data(),{multiple:null===s.multiple?i.is("[multiple]"):s.multiple,disabled:null===s.disabled?i.is("[disabled]"):s.disabled,originalValue:a.value});return this.set(t),t},get:function(e){var t=i.data("flexdatalist");return e?a.isDefined(t,e)?t[e]:null:t||{}},set:function(e,t){var r=this.get();return a.isDefined(r,e)&&a.isDefined(t)?r[e]=t:a.isObject(e)&&(r=this._normalize(e)),i.data("flexdatalist",r),i},_normalize:function(t){if(t.searchIn=a.csvToArray(t.searchIn),t.relatives=t.relatives&&e(t.relatives).length>0?e(t.relatives):null,t.textProperty=null===t.textProperty?t.searchIn[0]:t.textProperty,t.visibleProperties=a.csvToArray(t.visibleProperties,t.searchIn),"*"===t.valueProperty&&t.multiple&&!t.selectionRequired)throw new Error("Selection must be required for multiple, JSON fields!");return t}},this.position=function(){var t=e("ul.flexdatalist-results"),i=t.data("target");t.length>0&&t.css({width:i.outerWidth()+"px",top:i.offset().top+i.outerHeight()+"px",left:i.offset().left+"px"})},this.fdisabled=function(e){if(this.isDefined(e)){if(i.prop("disabled",e),o.prop("disabled",e),u){u.css("background-color",i.css("background-color"));var t=u.find("li .fdl-remove"),a=u.find("li.input-container");e?(u.addClass("disabled"),t.length>0&&a.hide(),t.hide()):(u.removeClass("disabled"),a.show(),t.show())}this.options.set("disabled",e)}return this.options.get("disabled")},this.isDup=function(e){return!this.options.get("allowDuplicateValues")&&(n.length>0&&n.indexOf(this.fvalue.value(e))>-1)},this.keyNum=function(e){return e.which||e.keyCode},this.isEmpty=function(t){return!a.isDefined(t)||(null===t||!0!==t&&(0===this.length(t)||""===e.trim(t)))},this.isObject=function(e){return e&&"object"==typeof e},this.length=function(e){return this.isObject(e)?Object.keys(e).length:"number"==typeof e||"number"==typeof e.length?e.toString().length:0},this.isDefined=function(e,t){var i=void 0!==e;return i&&void 0!==t?void 0!==e[t]:i},this.unixtime=function(e){var t=new Date;return e&&(t=new Date(e)),Math.round(t.getTime()/1e3)},this.csvToArray=function(e,t){return 0===e.length?t:"string"==typeof e?e.split(a.options.get("valuesSeparator")):e},this.debug=function(t,r){var s=a.options.get();s.debug&&(r||(r={}),t="Flexdatalist: "+t,console.warn(t),console.log(e.extend({inputName:i.attr("name"),options:s},r)),console.log("--- /flexdatalist ---"))},this.init()})}}(jQuery),function(e){e(document).data("flexdatalist")||e(document).mouseup(function(t){var i=e(".flexdatalist-results"),a=i.data("target");a&&a.is(":focus")||i.is(t.target)||0!==i.has(t.target).length||i.remove()}).keydown(function(t){var i=e(".flexdatalist-results"),a=i.find("li"),r=a.filter(".active"),s=r.index(),n=a.length,l=t.which||t.keyCode;if(0!==n)if(27!==l){if(13===l)t.preventDefault(),r.click();else if(40===l||38===l){t.preventDefault(),40===l?r=s<n&&r.nextAll(".item").first().length>0?r.removeClass("active").nextAll(".item").first().addClass("active"):a.removeClass("active").filter(".item:first").addClass("active"):38===l&&(r=s>0&&r.prevAll(".item").first().length>0?r.removeClass("active").prevAll(".item").first().addClass("active"):a.removeClass("active").filter(".item:last").addClass("active")),r.trigger("active:flexdatalist.results",[r.data("item")]);var o=(0===r.prev().length?r:r.prev()).position().top;i.animate({scrollTop:o+i.scrollTop()},100)}}else i.remove()}).data("flexdatalist",!0),jQuery("input.flexdatalist:not(.flexdatalist-set):not(.autodiscover-disabled)").flexdatalist()}(jQuery),function(e){var t=e.fn.val;e.fn.val=function(e){var i=this.length>0&&void 0!==this[0].fvalue;return void 0===e?i?this[0].fvalue.get(!0):t.call(this):i?this[0].fvalue.set(e):t.call(this,e)}}(jQuery);
